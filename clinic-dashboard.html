<script>
const urlParams = new URLSearchParams(window.location.search);
const pin = urlParams.get("pin");

fetch('plans.json')
  .then(response => response.json())
  .then(plans => {
    if (plans[pin]) {
      document.getElementById("planName").textContent = plans[pin].plan;
      document.getElementById("clinicName").textContent = plans[pin].clinic;

      // ðŸ‘‡ Load and show today's appointments
      const csvFile = `${plans[pin].logs}`;
      const today = new Date().toISOString().split("T")[0];

      fetch(csvFile)
        .then(response => response.text())
        .then(data => {
          const rows = data.split("\n").slice(1); // skip header
          let html = "";

          rows.forEach(row => {
            const [date, time, name, reason, contact, clinic, token, reminder, reminderSent] = row.split(",");
            if (date === today) {
              html += `
                <tr>
                  <td>${time}</td>
                  <td>${name}</td>
                  <td>${reason}</td>
                  <td><a href="tel:${contact.trim()}">${contact.trim()}</a></td>
                  <td>${reminderSent || ""}</td>
                </tr>`;
            }
          });

          document.getElementById("appointments").innerHTML = html || "<tr><td colspan='5'>No bookings today</td></tr>";
        });

    } else {
      alert("Invalid PIN. Access Denied.");
      window.location.href = "index.html";
    }
  });
</script><h2>ðŸ“‹ Clinic Dashboard â€“ Today's Appointments</h2>
<p>Date: <span id="todayDate"></span></p>
<table border="1" style="width:100%;color:white;">
  <thead>
    <tr><th>Time</th><th>Patient Name</th><th>Reason</th><th>Contact</th><th>Status</th></tr>
  </thead>
  <tbody id="appointments"></tbody>
</table>
<script>
  document.getElementById("todayDate").textContent = new Date().toISOString().split("T")[0];
</script>
