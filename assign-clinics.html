<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assign Clinics (plans.json Editor)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      padding: 20px;
    }
    h2 {
      color: #4dc1ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #1e1e1e;
    }
    th, td {
      padding: 12px;
      border: 1px solid #444;
      text-align: left;
    }
    input, select {
      padding: 8px;
      background-color: #2c2c2c;
      color: white;
      border: 1px solid #666;
      width: 100%;
    }
    button {
      padding: 10px 20px;
      margin-top: 20px;
      background-color: #28a745;
      border: none;
      color: white;
      cursor: pointer;
    }
    .json-output {
      white-space: pre-wrap;
      background: #1e1e1e;
      padding: 10px;
      margin-top: 20px;
      border: 1px solid #333;
    }
  </style>
</head>
<body>

<h2>üõ†Ô∏è Assign Clinics ‚Äì PIN & Plan Control</h2>

<input type="file" id="jsonFile" accept=".json">
<br/><br/>

<table id="editorTable">
  <thead>
    <tr>
      <th>Clinic</th>
      <th>PIN</th>
      <th>Plan</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="downloadUpdatedJSON()">üíæ Download Updated plans.json</button>

<script>
let plansData = {};

document.getElementById("jsonFile").addEventListener("change", function (e) {
  const reader = new FileReader();
  reader.onload = function () {
    plansData = JSON.parse(reader.result);
    populateTable();
  };
  reader.readAsText(e.target.files[0]);
});

function populateTable() {
  const tbody = document.querySelector("#editorTable tbody");
  tbody.innerHTML = "";

  Object.entries(plansData).forEach(([clinic, { pin, plan }]) => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td><input value="${clinic}" data-clinic="${clinic}" onchange="updateClinicKey(this)"></td>
      <td><input value="${pin}" data-clinic="${clinic}" data-field="pin" onchange="updateField(this)"></td>
      <td>
        <select data-clinic="${clinic}" data-field="plan" onchange="updateField(this)">
          <option value="free" ${plan === "free" ? "selected" : ""}>Free</option>
          <option value="paid" ${plan === "paid" ? "selected" : ""}>Paid</option>
          <option value="premium" ${plan === "premium" ? "selected" : ""}>Premium</option>
        </select>
      </td>
    `;

    tbody.appendChild(row);
  });
}

function updateField(element) {
  const clinic = element.getAttribute("data-clinic");
  const field = element.getAttribute("data-field");
  plansData[clinic][field] = element.value.trim();
}

function updateClinicKey(input) {
  const oldKey = input.getAttribute("data-clinic");
  const newKey = input.value.trim();

  if (oldKey !== newKey && newKey) {
    plansData[newKey] = plansData[oldKey];
    delete plansData[oldKey];
    populateTable();
  }
}

function downloadUpdatedJSON() {
  const blob = new Blob([JSON.stringify(plansData, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "plans.json";
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
