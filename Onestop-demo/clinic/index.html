<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clinic • PIN</title>
<link rel="manifest" href="./manifest.webmanifest"><link rel="stylesheet" href="./styles.css">
<meta name="theme-color" content="#111"/>
<style>
main{max-width:720px;margin:16px auto;padding:16px}
input{width:100%;padding:14px;border:1px solid #ddd;border-radius:12px;font-size:16px}
.iconbtn{display:flex;align-items:center;gap:10px}
.iconbtn img{width:22px;height:22px;border-radius:6px}
</style></head><body>
<main>
  <img class="banner" src="./assets/clinic_banner.png" alt="Clinic"/>
  <div class="card" style="margin-top:16px">
    <h2 style="margin:0 0 8px">Enter PIN</h2>
    <p class="muted">You’ll be routed automatically.</p>
    <form id="pinForm">
      <input id="pin" type="password" placeholder="4–8 digit PIN" inputmode="numeric" autocomplete="one-time-code" required style="margin:10px 0">
      <button class="btn" style="width:100%">Continue</button>
    </form>
    <div id="msg" class="muted" style="margin-top:8px"></div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin:0 0 8px">Quick Access</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <a class="btn iconbtn" href="./booking.html"><img src="./assets/icons/book.png" onerror="this.style.display='none'">Booking Bot</a>
      <a class="btn iconbtn" href="./admin.html"><img src="./assets/icons/admin.png" onerror="this.style.display='none'">Admin</a>
      <a class="btn iconbtn" href="./doctor.html"><img src="./assets/icons/doctor.png" onerror="this.style.display='none'">Doctor/Manager</a>
      <a class="btn iconbtn" href="./reset.html"><img src="./assets/icons/reset.png" onerror="this.style.display='none'">Reset Cache</a>
    </div>
  </div>
</main>
<script>
if("serviceWorker" in navigator){navigator.serviceWorker.register("./sw.js").catch(()=>{});}
const rolePage={ doctor:"./doctor.html", admin:"./admin.html" };
async function loadPins(){ try{const r=await fetch("./pins.json",{cache:"no-store"});return await r.json()}catch{return{}} }
document.getElementById("pinForm").addEventListener("submit", async (e)=>{
  e.preventDefault(); const pin=document.getElementById("pin").value.trim(); const msg=document.getElementById("msg");
  msg.textContent="Checking…"; try{
    const p=await loadPins(); let matched=null; for(const [role,val] of Object.entries(p)){ if(String(val)===pin){matched=role;break;} }
    if(!matched){ msg.textContent="Invalid PIN."; return; }
    sessionStorage.setItem("clinic_role", matched); sessionStorage.setItem("clinic_login_at", String(Date.now()));
    location.replace(rolePage[matched]||"./index.html");
  }catch{ msg.textContent="Error loading pins.json"; }
});
</script></body></html>
