<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Apartments • PIN (Safe Mode)</title>
<link rel="stylesheet" href="./styles.css">
<meta name="theme-color" content="#111"/>
</head>
<body class="bg">
<main class="wrap">
  <div class="card hero">
    <img class="banner" src="./assets/apartments_banner.png" alt>
    <div class="hero-overlay">
      <img class="logo" src="./assets/logo.png" onerror="this.style.display='none'">
      <div class="hero-title">Onestop Apartments</div>
    </div>
  </div>

  <div class="card mt">
    <h2 class="h2">Login PIN</h2>
    <p class="muted">Welcome</p>
    <form id="pinForm">
      <input id="pin" type="password" inputmode="numeric" placeholder="4–8 digit PIN" class="in">
      <button class="btn w100 mt8">Submit</button>
    </form>
    <div id="msg" class="muted mt8"></div>
  </div>
</main>

<script>
const rolePage={residents:"./residents.html",guards:"./guards.html",committee:"./committee.html",admin:"./admin.html"};
const FALLBACK_PINS={residents:"1111",guards:"2222",committee:"3333",admin:"4444"};

async function loadPins(){
  try{
    const r=await fetch("./pins.json?v="+Date.now(),{cache:"no-store"});
    if(!r.ok) throw 0;
    return JSON.parse(await r.text());
  }catch{return FALLBACK_PINS}
}
document.getElementById("pinForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const pin=document.getElementById("pin").value.trim();
  const msg=document.getElementById("msg");
  msg.textContent="Checking…";
  const pins=await loadPins();
  let role=null; for(const [k,v] of Object.entries(pins)){ if(String(v)===pin){ role=k; break; } }
  if(!role){ msg.textContent="Invalid PIN."; return; }
  sessionStorage.setItem("apt_role",role);
  location.replace(rolePage[role]);
});
</script>
</body></html>
