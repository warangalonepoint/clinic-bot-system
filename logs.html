<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clinic Logs Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background-color: #111;
      color: #fff;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    h1, h2 {
      color: #4dc1ff;
    }
    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
    }
    th, td {
      white-space: nowrap;
    }
    button {
      margin: 5px;
    }
    #reason-filters button {
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>Clinic Logs Dashboard</h1>  <div>
    <button onclick="filterByToday()">Today</button>
    <button onclick="filterByYesterday()">Yesterday</button>
    <input type="date" id="startDate"> to
    <input type="date" id="endDate">
    <button onclick="applyDateFilter()">Apply</button>
    <button onclick="exportToExcel()">Export to Excel</button>
    <button onclick="exportToPDF()">Export to PDF</button>
  </div>  <div id="reason-filters" style="margin: 10px 0;"></div>  <div class="table-container">
    <table class="table table-dark table-striped" id="logsTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Patient Name</th>
          <th>Reason</th>
          <th>Contact</th>
          <th>Reminder Sent</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div><canvas id="summaryChart" height="100"></canvas>

  <script>
    let logs = [];
    let currentReasonFilter = null;

    async function fetchLogs() {
      const response = await fetch('logs.csv');
      const data = await response.text();
      const rows = data.split('\n').slice(1);
      logs = rows.map(row => {
        const [Date, Time, Name, Reason, Contact, Reminder] = row.split(',');
        return { Date, Time, Name, Reason, Contact, Reminder };
      });
      generateReasonFilters(logs);
      displayFilteredLogs();
      drawChart();
    }

    function displayFilteredLogs(filtered = logs) {
      const tableBody = document.querySelector("#logsTable tbody");
      tableBody.innerHTML = "";
      const displayLogs = currentReasonFilter ? filtered.filter(log => log.Reason === currentReasonFilter) : filtered;
      displayLogs.forEach(log => {
        const row = `<tr><td>${log.Date}</td><td>${log.Time}</td><td>${log.Name}</td><td>${log.Reason}</td><td><a href="tel:${log.Contact}">${log.Contact}</a></td><td>${log.Reminder}</td></tr>`;
        tableBody.innerHTML += row;
      });
    }

    function applyDateFilter() {
      const start = document.getElementById("startDate").value;
      const end = document.getElementById("endDate").value;
      if (!start || !end) return;
      const filtered = logs.filter(log => {
        const d = new Date(log.Date.split('-').reverse().join('-'));
        return d >= new Date(start) && d <= new Date(end);
      });
      displayFilteredLogs(filtered);
    }

    function filterByToday() {
      const today = new Date().toISOString().slice(0, 10);
      const filtered = logs.filter(log => log.Date.split('-').reverse().join('-') === today);
      displayFilteredLogs(filtered);
    }

    function filterByYesterday() {
      const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
      const filtered = logs.filter(log => log.Date.split('-').reverse().join('-') === yesterday);
      displayFilteredLogs(filtered);
    }

    function exportToExcel() {
      const ws = XLSX.utils.json_to_sheet(logs);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Logs");
      XLSX.writeFile(wb, "clinic_logs.xlsx");
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const headers = [["Date", "Time", "Name", "Reason", "Contact", "Reminder Sent"]];
      const rows = logs.map(l => [l.Date, l.Time, l.Name, l.Reason, l.Contact, l.Reminder]);
      doc.autoTable({ head: headers, body: rows });
      doc.save("clinic_logs.pdf");
    }

    function generateReasonFilters(logs) {
      const reasonSet = new Set(logs.map(log => log.Reason.trim()).filter(Boolean));
      const filterContainer = document.getElementById("reason-filters");
      filterContainer.innerHTML = '';
      reasonSet.forEach(reason => {
        const btn = document.createElement("button");
        btn.textContent = reason;
        btn.style.background = "#1e88e5";
        btn.style.color = "white";
        btn.style.border = "none";
        btn.style.padding = "6px 10px";
        btn.style.margin = "4px";
        btn.style.borderRadius = "5px";
        btn.onclick = () => applyReasonFilter(reason);
        filterContainer.appendChild(btn);
      });
      const clearBtn = document.createElement("button");
      clearBtn.textContent = "Clear Filter";
      clearBtn.style.background = "#757575";
      clearBtn.style.color = "white";
      clearBtn.style.border = "none";
      clearBtn.style.padding = "6px 10px";
      clearBtn.style.margin = "4px";
      clearBtn.style.borderRadius = "5px";
      clearBtn.onclick = () => {
        currentReasonFilter = null;
        displayFilteredLogs();
      };
      filterContainer.appendChild(clearBtn);
    }

    function applyReasonFilter(reason) {
      currentReasonFilter = reason;
      displayFilteredLogs();
    }

    function drawChart() {
      const ctx = document.getElementById("summaryChart").getContext("2d");
      const labels = {};
      logs.forEach(log => {
        labels[log.Reason] = (labels[log.Reason] || 0) + 1;
      });
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: Object.keys(labels),
          datasets: [{
            label: "Visit Reasons",
            data: Object.values(labels),
            backgroundColor: "#4dc1ff"
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    fetchLogs();
  </script></body>
</html>
