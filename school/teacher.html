<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teacher • School PWA</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <main>
    <div class="topbar">
      <span class="badge">Teacher / Manager</span>
      <div style="display:flex; gap:8px; align-items:center">
        <label title="Dark / Light"><input id="themeToggle" class="theme-toggle" type="checkbox"/></label>
        <a class="btn ghost" href="./index.html">Logout</a>
      </div>
    </div>

    <header class="hero panel"><div class="title">Today</div></header>

    <section class="panel" style="margin-top:14px">
      <div class="tabs">
        <button class="tab active" data-t="diary">Post Diary</button>
        <button class="tab" data-t="hw">Homework</button>
        <button class="tab" data-t="att">Attendance</button>
        <button class="tab" data-t="broadcast">Broadcast</button>
      </div>

      <!-- Diary -->
      <div id="sec-diary" class="section active">
        <div class="row">
          <div class="card gradient-1">
            <h2>Post to Class Diary</h2>
            <label>Date</label><input id="d-date" type="date" />
            <label>Subject</label><input id="d-sub" placeholder="e.g., Maths" />
            <label>Message</label><textarea id="d-msg" placeholder="What was taught / notes…"></textarea>
            <label>Optional Link</label><input id="d-link" placeholder="https://…" />
            <div class="spacer"></div>
            <button id="btnDiary" class="btn">Publish</button>
          </div>
          <div class="card gradient-2">
            <h2>Recent</h2>
            <table class="table" id="tblDiary"><thead>
              <tr><th>Date</th><th>Subject</th><th>Message</th></tr>
            </thead><tbody></tbody></table>
          </div>
        </div>
      </div>

      <!-- Homework -->
      <div id="sec-hw" class="section">
        <div class="row">
          <div class="card gradient-3">
            <h2>Create Homework</h2>
            <label>Due Date</label><input id="h-due" type="date"/>
            <label>Subject</label><input id="h-sub" placeholder="e.g., Science"/>
            <label>Title</label><input id="h-title" placeholder="e.g., Exercise 5A"/>
            <label>Details</label><textarea id="h-det" placeholder="Q1-10…"></textarea>
            <div class="spacer"></div>
            <button id="btnHw" class="btn">Publish</button>
          </div>
          <div class="card gradient-4">
            <h2>Assigned</h2>
            <table class="table" id="tblHw"><thead>
              <tr><th>Due</th><th>Subject</th><th>Title</th></tr>
            </thead><tbody></tbody></table>
          </div>
        </div>
      </div>

      <!-- Attendance (demo marker only) -->
      <div id="sec-att" class="section">
        <div class="card gradient-2">
          <h2>Attendance (Demo)</h2>
          <p class="muted">In live mode, bind with class roster and mark status. Here we store a simple timestamp.</p>
          <button class="btn" id="btnAtt">Mark Class Taken</button>
          <div class="spacer"></div>
          <ul id="attList" class="muted"></ul>
        </div>
      </div>

      <!-- Broadcast -->
      <div id="sec-broadcast" class="section">
        <div class="card gradient-1">
          <h2>Broadcast to Parents</h2>
          <label>Message</label><textarea id="bc-msg" placeholder="Short announcement…"></textarea>
          <div class="spacer"></div>
          <button class="btn" id="btnBc">Send</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Theme
    const root=document.documentElement;
    const tSaved=localStorage.getItem('theme')||'dark';
    root.setAttribute('data-theme',tSaved);
    document.getElementById('themeToggle').checked = (tSaved==='light');
    document.getElementById('themeToggle').addEventListener('change',e=>{
      const t=e.target.checked?'light':'dark'; root.setAttribute('data-theme',t); localStorage.setItem('theme',t);
    });

    // Tabs
    document.querySelectorAll('.tab').forEach(b=>{
      b.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
        document.getElementById('sec-'+b.dataset.t).classList.add('active');
      });
    });

    const L={
      get:k=>JSON.parse(localStorage.getItem(k)||"[]"),
      set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
    };

    function rows(el,arr,map){ const tb=el.querySelector('tbody'); tb.innerHTML=""; arr.slice(-20).reverse().forEach(it=>tb.insertAdjacentHTML('beforeend',map(it))); }

    function render(){
      rows(document.getElementById('tblDiary'), L.get('diary'), d=>`<tr><td>${new Date(d.date).toLocaleDateString()}</td><td>${d.subject}</td><td>${d.msg}</td></tr>`);
      rows(document.getElementById('tblHw'), L.get('hw'), h=>`<tr><td>${new Date(h.due).toLocaleDateString()}</td><td>${h.subject}</td><td>${h.title}</td></tr>`);
      const ul=document.getElementById('attList'); ul.innerHTML=""; L.get('att').slice(-10).reverse().forEach(a=>ul.insertAdjacentHTML('beforeend', `<li>${new Date(a).toLocaleString()}</li>`));
    }
    render();

    // Actions
    document.getElementById('btnDiary').addEventListener('click', ()=>{
      const date=document.getElementById('d-date').value||new Date().toISOString().slice(0,10);
      const subject=document.getElementById('d-sub').value||'General';
      const msg=document.getElementById('d-msg').value.trim(); if(!msg) return alert('Message required');
      const link=document.getElementById('d-link').value.trim();
      const arr=L.get('diary'); arr.push({date,subject,msg,link}); L.set('diary',arr); render();
      document.getElementById('d-msg').value=""; alert('Posted to diary.');
    });

    document.getElementById('btnHw').addEventListener('click', ()=>{
      const due=document.getElementById('h-due').value||new Date().toISOString().slice(0,10);
      const subject=document.getElementById('h-sub').value||'General';
      const title=document.getElementById('h-title').value||'Homework';
      const details=document.getElementById('h-det').value||'';
      const arr=L.get('hw'); arr.push({due,subject,title,details}); L.set('hw',arr); render(); alert('Homework published.');
    });

    document.getElementById('btnAtt').addEventListener('click', ()=>{
      const arr=L.get('att'); arr.push(Date.now()); L.set('att',arr); render(); alert('Attendance marked (demo).');
    });

    document.getElementById('btnBc').addEventListener('click', ()=>{
      const text=document.getElementById('bc-msg').value.trim(); if(!text) return alert('Type a message');
      const arr=L.get('msgs'); arr.push({time:Date.now(), text}); L.set('msgs',arr); alert('Sent to parents (demo).'); document.getElementById('bc-msg').value="";
    });
  </script>
</body>
</html>
