<!DOCTYPE html><html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Logs - Onestop AI Clinic</title>
</head>
<body>
    <h1>Booking Logs</h1><div>
    <label for="dateFilter">Filter by Date:</label>
    <input type="date" id="dateFilter">

    <label for="statusFilter">Status:</label>
    <select id="statusFilter">
        <option value="">All</option>
        <option value="Booked">Booked</option>
        <option value="Available">Available</option>
    </select>

    <button onclick="exportCSV()">⬇️ Export Logs as CSV</button>
</div>

<table border="1" id="logsTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Time Slot</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const apiKey = 'patLNwoJQKE3Tjb8J.c2a0db129111c610fae64a2c01e0a626f37bdb5992232ea6ebc644fa9073dfb3';
    const baseId = 'appgIT8WiqnZlR44Y';
    const tableName = 'AvailableSlots';

    async function fetchData() {
        const url = `https://api.airtable.com/v0/${baseId}/${tableName}`;
        const response = await fetch(url, {
            headers: { Authorization: `Bearer ${apiKey}` }
        });
        const data = await response.json();
        return data.records;
    }

    function renderTable(records) {
        const tbody = document.querySelector('#logsTable tbody');
        tbody.innerHTML = '';

        records.forEach(record => {
            const date = record.fields['Date'] || '';
            const time = record.fields['Time Slot'] || '';
            const status = record.fields['Status'] || '';

            const row = `<tr>
                <td>${date}</td>
                <td>${time}</td>
                <td>${status}</td>
            </tr>`;

            tbody.insertAdjacentHTML('beforeend', row);
        });
    }

    function filterTable() {
        const dateFilter = document.getElementById('dateFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;

        fetchData().then(records => {
            let filtered = records;
            if (dateFilter) {
                filtered = filtered.filter(r => r.fields['Date'] === dateFilter);
            }
            if (statusFilter) {
                filtered = filtered.filter(r => r.fields['Status'] === statusFilter);
            }
            renderTable(filtered);
        });
    }

    function exportCSV() {
        const rows = [...document.querySelectorAll('#logsTable tr')]
            .map(row => [...row.children].map(cell => cell.innerText).join(","))
            .join("\n");

        const blob = new Blob([rows], { type: 'text/csv' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'BookingLogs.csv';
        link.click();
    }

    document.getElementById('dateFilter').addEventListener('change', filterTable);
    document.getElementById('statusFilter').addEventListener('change', filterTable);

    fetchData().then(renderTable);
</script></body>
</html>
