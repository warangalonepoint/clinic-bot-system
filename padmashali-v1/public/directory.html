<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Directory</title>
<link rel="stylesheet" href="styles.css?v=3">
<script src="i18n.js?v=3"></script>
<script src="theme.js?v=3" defer></script>
<script src="banner.js?v=3" defer></script>
<script src="app.js?v=3" defer></script>
</head><body>
<div class="wrap">
  <div id="app-banner"></div>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <h2 data-i18n="directory">Directory</h2>
      <div>
        <a class="ghost btn" href="directory-manage.html">Manage</a>
        <button class="ghost btn" id="exportBtn">Export CSV</button>
      </div>
    </div>
  </div>
  <div class="card">
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px">
      <input id="q" class="input" style="min-width:220px" placeholder="Search…">
      <select id="area" class="input"><option value="">Any Area</option></select>
      <select id="seva" class="input"><option value="">Any Seva</option></select>
    </div>
    <table class="table"><thead><tr><th>Name</th><th>Area</th><th>Seva</th><th>Email</th><th>Phone</th></tr></thead>
      <tbody id="rows"></tbody></table>
    <p id="empty" class="muted" style="display:none">No results</p>
  </div>
  <footer>© Padmashali Community — V1</footer>
</div>
<script>
const S=JSON.parse(localStorage.getItem("pc_session")||"null"); if(!S){location.href='index.html';}
const K='pc_directory';
function getAll(){return JSON.parse(localStorage.getItem(K)||'[]');}
function setAll(v){localStorage.setItem(K,JSON.stringify(v));}
function unique(v){return Array.from(new Set(v.filter(Boolean))).sort();}
function seed(){ if(getAll().length) return; setAll([
  {id:'D1',name:"G. Srinivas", area:"Warangal", seva:"Education", phone:"9390011111", email:"gs@example.com"},
  {id:'D2',name:"S. Laxmi", area:"Hanamkonda", seva:"Annadanam", phone:"9390022222", email:"sl@example.com"},
  {id:'D3',name:"K. Raju", area:"Kazipet", seva:"Health", phone:"9390033333", email:"kr@example.com"}]);}
function buildFilters(){
  const L=getAll();
  area.innerHTML='<option value="">Any Area</option>'+unique(L.map(x=>x.area)).map(a=>`<option>${a}</option>`).join('');
  seva.innerHTML='<option value="">Any Seva</option>'+unique(L.map(x=>x.seva)).map(a=>`<option>${a}</option>`).join('');
}
function filter(){
  const text=(q.value||'').toLowerCase(), a=area.value, s=seva.value;
  const list=getAll().filter(x=>{
    const okT=!text || `${x.name} ${x.area} ${x.seva} ${x.phone} ${x.email||''}`.toLowerCase().includes(text);
    const okA=!a||x.area===a, okS=!s||x.seva===s; return okT&&okA&&okS;
  }).sort((m,n)=>m.name.localeCompare(n.name));
  rows.innerHTML=''; empty.style.display=list.length?'none':'block';
  list.forEach(x=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td><b>${x.name}</b></td><td>${x.area||''}</td><td>${x.seva||''}</td><td>${x.email||'—'}</td><td><a href="tel:${x.phone}">${x.phone||''}</a></td>`;
    rows.appendChild(tr);
  });
}
exportBtn.onclick=()=>{
  const L=getAll(); const rows=[['ID','Name','Area','Seva','Email','Phone'],...L.map(x=>[x.id,x.name||'',x.area||'',x.seva||'',x.email||'',x.phone||''])];
  const csv = rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='directory.csv'; a.click(); URL.revokeObjectURL(url);
}
seed(); buildFilters(); [q,area,seva].forEach(el=>el.addEventListener('input',filter)); filter();
</script>
</body></html>
