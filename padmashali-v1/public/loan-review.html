<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Loan Review</title>
<link rel="stylesheet" href="styles.css?v=4">
<script src="i18n.js?v=4"></script>
<script src="theme.js?v=4" defer></script>
<script src="banner.js?v=4" defer></script>
<script src="app.js?v=4" defer></script>
  <link rel="stylesheet" href="styles.css?v=3">
<script src="i18n.js?v=3"></script>
<script src="theme.js?v=3" defer></script>
<script src="banner.js?v=3" defer></script>
<script src="app.js?v=3" defer></script>
</head><body>
<div class="wrap">
  <div id="app-banner"></div>
  <div class="card">
    <h2>ðŸ§¾ Loan Review</h2>
  </div>
  <div class="card">
    <b>Pending</b>
    <table class="table"><thead><tr><th>Date</th><th>Name</th><th>Phone</th><th>Amount</th><th>Months</th><th>Purpose</th><th>Collateral</th><th>Decision</th></tr></thead><tbody id="pending"></tbody></table>
  </div>
  <div class="card">
    <b>Decided</b>
    <table class="table"><thead><tr><th>Date</th><th>Name</th><th>Amount</th><th>Status</th><th>Decision</th></tr></thead><tbody id="done"></tbody></table>
  </div>
  <footer>Â© Padmashali Community â€” V1</footer>
</div>
<script>
const s=JSON.parse(localStorage.getItem("pc_session")||"null"); if(!s||(s.role!=='committee'&&s.role!=='admin')) location.href='index.html';
const K='pc_loans';
function getAll(){return JSON.parse(localStorage.getItem(K)||'[]');} function setAll(v){localStorage.setItem(K,JSON.stringify(v));}
function fmtMoney(x){return 'â‚¹'+Number(x).toLocaleString('en-IN');}
function emi(p, annualRate, m){const r=annualRate/12/100; if(!r) return p/m; return p*r*Math.pow(1+r,m)/(Math.pow(1+r,m)-1);}
function render(){const L=getAll().sort((a,b)=>b.ts-a.ts); const P=document.getElementById('pending'); const D=document.getElementById('done'); P.innerHTML=''; D.innerHTML='';
  L.forEach(x=>{ if(x.status==='Pending'){ const tr=document.createElement('tr');
      tr.innerHTML=`<td>${new Date(x.ts).toLocaleDateString('en-IN')}</td><td>${x.name}</td><td>${x.phone}</td><td>${fmtMoney(x.amount)}</td><td>${x.months}</td><td>${x.purpose}</td><td>${x.collateral||'â€”'}</td>
      <td><div style="display:flex;gap:6px;flex-wrap:wrap">
        <input id="amt_${x.id}" class="input" type="number" value="${x.amount}" style="width:120px">
        <input id="mon_${x.id}" class="input" type="number" value="${x.months}" style="width:120px">
        <input id="rate_${x.id}" class="input" type="number" step="0.1" value="${x.rate||12}" style="width:120px">
        <button class="btn" onclick="approve('${x.id}')">Approve</button>
        <button class="ghost btn" onclick="reject('${x.id}')">Reject</button></div></td>`; P.appendChild(tr);
    } else { const dec=x.decision?`â‚¹${x.decision.approvedAmount} / ${x.decision.months}m @ ${x.decision.rate}% (EMI â‚¹${x.decision.emi})`:'â€”';
      const tr=document.createElement('tr'); tr.innerHTML=`<td>${new Date(x.ts).toLocaleDateString('en-IN')}</td><td>${x.name}</td><td>${fmtMoney(x.amount)}</td><td><span class="badge">${x.status}</span></td><td>${dec}</td>`; D.appendChild(tr);}
  });
}
window.approve=id=>{const L=getAll(); const i=L.findIndex(z=>z.id===id); if(i<0) return; const amt=+document.getElementById('amt_'+id).value||0, mon=+document.getElementById('mon_'+id).value||0, rate=+document.getElementById('rate_'+id).value||12; if(!amt||!mon){alert('Enter amount & months');return;}
  const e=Math.round(emi(amt,rate,mon)); L[i].status='Approved'; L[i].decision={approvedAmount:amt,months:mon,rate,emi:e}; setAll(L); render();};
window.reject=id=>{const L=getAll(); const i=L.findIndex(z=>z.id===id); if(i<0) return; L[i].status='Rejected'; L[i].decision=null; setAll(L); render();};
render();
</script>
</body></html>
