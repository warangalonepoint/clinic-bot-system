<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Your Appointment ‚Äì Onestop Ai Clinic Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* (Styling same as before for simplicity) */
  </style>
</head>
<body>
  <h1>Book Your Appointment</h1>

  <div>
    <label>Date</label>
    <select id="date"></select>
  </div>

  <div>
    <label>Time Slot</label>
    <select id="slot">
      <option>Select a date first</option>
    </select>
  </div>

  <div>
    <label>Name</label>
    <input type="text" id="name" placeholder="Your Name">
  </div>

  <div>
    <label>Reason for Visit</label>
    <input type="text" id="reason" placeholder="E.g., Fever, Consultation...">
  </div>

  <button onclick="bookNow()">Book on WhatsApp</button>

  <script>
    const slotsUrl = "https://warangalonepoint.github.io/clinic-bot-system/clinic/slots.csv";
    const logsUrl = "https://warangalonepoint.github.io/clinic-bot-system/clinic/logs.csv";

    let allSlots = [];
    let booked = [];

    async function loadCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const rows = text.trim().split("\\n").slice(1).map(r => r.split(","));
      return rows;
    }

    async function init() {
      allSlots = await loadCSV(slotsUrl);
      booked = await loadCSV(logsUrl);
      const dateSet = [...new Set(allSlots.map(r => r[0]))].filter(d => new Date(d) >= new Date());
      const dateDropdown = document.getElementById("date");
      dateDropdown.innerHTML = `<option>Select date</option>` + dateSet.map(d => `<option value="${d}">${d}</option>`).join("");
    }

    function loadSlots() {
      const selectedDate = document.getElementById("date").value;
      const bookedSlots = booked.filter(b => b[0] === selectedDate).map(b => b[1]);
      const filtered = allSlots.filter(s => s[0] === selectedDate && !bookedSlots.includes(s[1]));
      const slotDropdown = document.getElementById("slot");
      slotDropdown.innerHTML = `<option>${filtered.length ? 'Select slot' : 'No slots available'}</option>` +
        filtered.map(s => `<option value="${s[1]}">${s[1]}</option>`).join("");
    }

    document.getElementById("date").addEventListener("change", loadSlots);

    function bookNow() {
      const date = document.getElementById("date").value;
      const slot = document.getElementById("slot").value;
      const name = document.getElementById("name").value;
      const reason = document.getElementById("reason").value;

      if (!date || !slot || !name || !reason) {
        alert("Please fill all fields");
        return;
      }

      const msg = `Booking Request:%0Aüßë Name: ${name}%0AüìÖ Date: ${date}%0A‚è∞ Time: ${slot}%0Aüìå Reason: ${reason}`;
      window.location.href = `https://wa.me/919390664577?text=${msg}`;
    }

    init();
  </script>
</body>
</html>
