<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parents • School PWA</title>
  <link rel="stylesheet" href="./styles.css" />
  <meta name="theme-color" content="#0b1020" />
</head>
<body>
  <main>
    <div class="topbar">
      <span class="badge">Parents</span>
      <div style="display:flex; gap:8px; align-items:center">
        <label title="Dark / Light"><input id="themeToggle" class="theme-toggle" type="checkbox"/></label>
        <a class="btn ghost" href="./index.html">Logout</a>
      </div>
    </div>

    <header class="hero panel"><div class="title">Parent Console</div></header>

    <section class="panel" style="margin-top:14px">
      <div class="tabs" id="tabs">
        <button class="tab active" data-t="diary">Class Diary</button>
        <button class="tab" data-t="homework">Homework</button>
        <button class="tab" data-t="messages">Messages</button>
        <button class="tab" data-t="leaves">Leaves</button>
        <button class="tab" data-t="complaints">Complaints</button>
        <button class="tab" data-t="fees">Fees</button>
      </div>

      <!-- Diary -->
      <div id="sec-diary" class="section active">
        <div class="card gradient-1"><h2>Recent Diary</h2>
          <table class="table" id="tblDiary"><thead>
            <tr><th>Date</th><th>Subject</th><th>Message</th><th>Link</th></tr>
          </thead><tbody></tbody></table>
          <p class="muted">Auto-synced from teacher posts (local demo).</p>
        </div>
      </div>

      <!-- Homework -->
      <div id="sec-homework" class="section">
        <div class="card gradient-2"><h2>Homework</h2>
          <table class="table" id="tblHw"><thead>
            <tr><th>Due</th><th>Subject</th><th>Title</th><th>Details</th></tr>
          </thead><tbody></tbody></table>
        </div>
      </div>

      <!-- Messages -->
      <div id="sec-messages" class="section">
        <div class="card gradient-3"><h2>Announcements</h2>
          <ul id="listMsgs" class="muted" style="margin:0;padding-left:18px"></ul>
        </div>
      </div>

      <!-- Leaves -->
      <div id="sec-leaves" class="section">
        <div class="row">
          <div class="card gradient-4">
            <h2>Request Leave</h2>
            <label>Date</label><input id="lvDate" type="date"/>
            <label>Reason</label><textarea id="lvReason" placeholder="Family function / Sick…"></textarea>
            <div class="spacer"></div>
            <button class="btn" id="btnLeave">Submit</button>
          </div>
          <div class="card gradient-3">
            <h2>My Leaves</h2>
            <table class="table" id="tblLeaves"><thead>
              <tr><th>Date</th><th>Reason</th><th>Status</th></tr>
            </thead><tbody></tbody></table>
          </div>
        </div>
      </div>

      <!-- Complaints -->
      <div id="sec-complaints" class="section">
        <div class="row">
          <div class="card gradient-2">
            <h2>Raise a Complaint</h2>
            <label>Subject</label><input id="cmpSub" placeholder="Bus delay, Teacher change…"/>
            <label>Details</label><textarea id="cmpMsg"></textarea>
            <div class="spacer"></div>
            <button class="btn warn" id="btnCmp">Submit</button>
          </div>
          <div class="card gradient-1">
            <h2>My Complaints</h2>
            <table class="table" id="tblCmp"><thead>
              <tr><th>Time</th><th>Subject</th><th>Status</th></tr>
            </thead><tbody></tbody></table>
          </div>
        </div>
      </div>

      <!-- Fees -->
      <div id="sec-fees" class="section">
        <div class="row">
          <div class="card gradient-1">
            <h2>Fee Summary</h2>
            <table class="table" id="tblFees"><thead>
              <tr><th>Term</th><th>Amount</th><th>Status</th></tr>
            </thead><tbody></tbody></table>
          </div>
          <div class="card gradient-4">
            <h2>Quick Pay (Demo)</h2>
            <p class="muted">In live mode this will open your payment link / UPI.</p>
            <button class="btn block">Pay Now</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // THEME
    const root=document.documentElement;
    const tSaved=localStorage.getItem('theme')||'dark';
    root.setAttribute('data-theme',tSaved);
    document.getElementById('themeToggle').checked = (tSaved==='light');
    document.getElementById('themeToggle').addEventListener('change',e=>{
      const t=e.target.checked?'light':'dark'; root.setAttribute('data-theme',t); localStorage.setItem('theme',t);
    });

    // Guard access
    if((sessionStorage.getItem('sch_role')||'')!=='parents'){ /* still allow for quick testing */ }

    // Tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.dataset.t;
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.getElementById('sec-'+id).classList.add('active');
      });
    });

    // Demo local data API
    const L = {
      get:(k)=>JSON.parse(localStorage.getItem(k)||"[]"),
      set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
    };

    // Render helpers
    function rows(el, arr, mapper){
      const tb = el.querySelector('tbody'); tb.innerHTML="";
      arr.forEach((it)=>tb.insertAdjacentHTML('beforeend', mapper(it)));
    }

    // Seed demo messages if empty
    if(!localStorage.getItem('msgs')){
      L.set('msgs',[
        {time:Date.now()-86400000, text:'Half-day on Friday for Sports meet.'},
        {time:Date.now()-3600*1000, text:'Bus route B will be delayed by 10 mins.'}
      ]);
    }
    if(!localStorage.getItem('fees')){
      L.set('fees',[
        {term:"Term 1", amt: "₹15,000", status:"Paid"},
        {term:"Term 2", amt: "₹15,000", status:"Due"}
      ]);
    }

    // Render all
    function render(){
      rows(document.getElementById('tblDiary'),
        L.get('diary').slice(-20).reverse(),
        (d)=>`<tr>
                <td>${new Date(d.date).toLocaleDateString()}</td>
                <td>${d.subject||'-'}</td>
                <td>${d.msg||''}</td>
                <td>${d.link?`<a href="${d.link}" target="_blank">Open</a>`:""}</td>
              </tr>`);

      rows(document.getElementById('tblHw'),
        L.get('hw').slice(-20).reverse(),
        (h)=>`<tr>
              <td>${new Date(h.due).toLocaleDateString()}</td>
              <td>${h.subject||'-'}</td>
              <td>${h.title||''}</td>
              <td>${h.details||''}</td>
            </tr>`);

      const ul=document.getElementById('listMsgs'); ul.innerHTML="";
      L.get('msgs').slice(-15).reverse().forEach(m=>{
        ul.insertAdjacentHTML('beforeend', `<li>${m.text} <span class="muted">· ${new Date(m.time).toLocaleString()}</span></li>`);
      });

      rows(document.getElementById('tblLeaves'), L.get('leaves').slice(-20).reverse(),
        (x)=>`<tr><td>${x.date}</td><td>${x.reason}</td><td>${x.status||'Pending'}</td></tr>`);

      rows(document.getElementById('tblCmp'), L.get('complaints').slice(-20).reverse(),
        (c)=>`<tr><td>${new Date(c.time).toLocaleString()}</td><td>${c.sub}</td><td>${c.status||'Open'}</td></tr>`);

      rows(document.getElementById('tblFees'), L.get('fees'),
        (f)=>`<tr><td>${f.term}</td><td>${f.amt}</td><td>${f.status}</td></tr>`);
    }
    render();

    // Actions
    document.getElementById('btnLeave').addEventListener('click', ()=>{
      const date=document.getElementById('lvDate').value;
      const reason=document.getElementById('lvReason').value.trim();
      if(!date||!reason) return alert("Select date & reason");
      const arr=L.get('leaves'); arr.push({date,reason,status:'Pending'}); L.set('leaves',arr); render();
      document.getElementById('lvReason').value=""; alert('Leave sent.');
    });

    document.getElementById('btnCmp').addEventListener('click', ()=>{
      const sub=document.getElementById('cmpSub').value.trim();
      const msg=document.getElementById('cmpMsg').value.trim();
      if(!sub||!msg) return alert("Subject & details required");
      const arr=L.get('complaints'); arr.push({time:Date.now(), sub, msg, status:'Open'}); L.set('complaints',arr); render();
      document.getElementById('cmpSub').value=""; document.getElementById('cmpMsg').value="";
      alert('Complaint submitted.');
    });
  </script>
</body>
</html>
