<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Local Bookings Log — Demo</title>
  <style>
    body{font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;margin:0;background:#f6f7fb;color:#0f1222}
    .wrap{max-width:860px;margin:24px auto;padding:16px}
    h1{font-size:24px;margin:10px 0}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.06)}
    th,td{padding:10px 12px;border-bottom:1px solid #eee;text-align:left}
    th{background:#f9fafb;font-weight:700}
    tr:last-child td{border-bottom:0}
    .row{display:flex;gap:10px;margin:12px 0 18px}
    button{padding:10px 14px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .danger{background:#111;color:#fff;border-color:#111}
    .muted{color:#6b7280}
    a{color:#5b4bff;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Local Bookings (this device only)</h1>
    <div class="row">
      <a href="./manual-bookings.html">← Back to booking</a>
      <button class="danger" id="clearAll">Clear All</button>
    </div>
    <div class="muted">Key: <code>onestop_bookings_v3</code></div>
    <table id="tbl">
      <thead>
        <tr><th>Patient</th><th>Phone</th><th>Date</th><th>Time</th><th>Token</th><th></th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const KEY='onestop_bookings_v3';
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch{return[]} }
    function save(v){ localStorage.setItem(KEY, JSON.stringify(v)); }
    function fmtPretty(iso){ const d=new Date(iso); return d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'}); }

    function render(){
      const data = load().sort((a,b)=> (a.date+b.time).localeCompare(b.date+b.time));
      const tb = document.querySelector('#tbl tbody');
      tb.innerHTML = data.length ? '' : `<tr><td colspan="6" class="muted">No local bookings</td></tr>`;
      data.forEach((r,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${r.name||''}</td>
          <td>${r.phone||''}</td>
          <td>${fmtPretty(r.date)}</td>
          <td>${r.time}</td>
          <td>${r.token}</td>
          <td><button data-i="${i}">Delete</button></td>
        `;
        tb.appendChild(tr);
      });
      tb.querySelectorAll('button[data-i]').forEach(btn=>{
        btn.onclick = ()=>{
          const idx=+btn.dataset.i; const arr=load(); arr.splice(idx,1); save(arr); render();
        };
      });
    }
    document.getElementById('clearAll').onclick = ()=>{
      if(confirm('Clear ALL local demo bookings on this device?')){ localStorage.removeItem(KEY); render(); }
    };
    render();
  </script>
</body>
</html>
