<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Apartments • PIN</title>
<link rel="manifest" href="./manifest.webmanifest">
<link rel="stylesheet" href="./styles.css">
<meta name="theme-color" content="#111"/>
</head>
<body class="bg">
<main class="wrap">
  <!-- Header -->
  <div class="card hero">
    <img class="banner" src="./assets/apartments_banner.png" alt="Apartments">
    <div class="hero-overlay">
      <img class="logo" src="./assets/logo.png" onerror="this.style.display='none'">
      <div class="hero-title">Onestop Apartments</div>
    </div>
  </div>

  <!-- PIN -->
  <div class="card mt">
    <h2 class="h2">Enter PIN</h2>
    <p class="muted">You’ll be routed to your role.</p>
    <form id="pinForm">
      <input id="pin" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="4–8 digit PIN" class="in">
      <button class="btn w100 mt8">Continue</button>
    </form>
    <div id="msg" class="muted mt8"></div>
  </div>
</main>

<script>
if("serviceWorker" in navigator){navigator.serviceWorker.register("./sw.js").catch(()=>{});}

const rolePage = {
  residents : "./residents.html",
  guards    : "./guards.html",
  committee : "./committee.html",
  admin     : "./admin.html"
};

async function loadPins(){
  const r = await fetch("./pins.json",{cache:"no-store"});
  if(!r.ok) throw new Error("pins.json missing");
  return r.json(); // { residents:"1111", guards:"2222", committee:"3333", admin:"4444" }
}

document.getElementById("pinForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const pin = document.getElementById("pin").value.trim();
  const msg = document.getElementById("msg");
  msg.textContent = "Checking…";
  try{
    const pins = await loadPins();
    let matched = null;
    for(const [role,val] of Object.entries(pins)){
      if(String(val)===pin){ matched = role; break; }
    }
    if(!matched){ msg.textContent = "Invalid PIN."; return; }
    sessionStorage.setItem("apt_role", matched);
    sessionStorage.setItem("apt_login_at", String(Date.now()));
    location.replace(rolePage[matched] || "./index.html");
  }catch(err){
    msg.textContent = "Error loading PINs.";
    console.error(err);
  }
});
</script>
</body></html>
