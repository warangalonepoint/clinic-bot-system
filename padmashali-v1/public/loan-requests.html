<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Loan Request</title>
<link rel="stylesheet" href="styles.css?v=3">
<script src="i18n.js?v=3"></script>
<script src="theme.js?v=3" defer></script>
<script src="banner.js?v=3" defer></script>
<script src="app.js?v=3" defer></script>
</head><body>
<div class="wrap">
  <div id="app-banner"></div>

  <div class="card">
    <h2>ðŸ’¸ <span data-i18n="loan_request">Loan Request</span></h2>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
      <input id="name" class="input" placeholder="Your Name">
      <input id="phone" class="input" placeholder="Phone">
      <input id="amount" class="input" type="number" placeholder="Amount (â‚¹)">
      <input id="purpose" class="input" placeholder="Purpose">
      <input id="months" class="input" type="number" placeholder="Term (months)">
      <input id="rate" class="input" type="number" step="0.1" placeholder="Rate % p.a. (optional)">
      <input id="collateral" class="input" placeholder="Collateral (optional)">
    </div>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button class="btn" id="calcBtn">EMI Preview</button><span id="emiBox" class="badge" style="display:none"></span>
      <button class="btn" id="submitBtn">Submit Request</button>
    </div>
  </div>

  <div class="card">
    <b>My Requests</b>
    <table class="table"><thead><tr><th>Date</th><th>Amount</th><th>Term</th><th>Purpose</th><th>Status</th><th>Decision</th></tr></thead><tbody id="mine"></tbody></table>
    <p class="muted" id="mineEmpty" style="display:none">No requests yet.</p>
  </div>

  <div class="card">
    <b>All Requests (read-only)</b>
    <table class="table"><thead><tr><th>Date</th><th>Name</th><th>Phone</th><th>Amount</th><th>Term</th><th>Purpose</th><th>Status</th></tr></thead><tbody id="all"></tbody></table>
  </div>

  <footer>Â© Padmashali Community â€” V1</footer>
</div>
<script>
const s=JSON.parse(localStorage.getItem("pc_session")||"null"); if(!s){location.href='index.html';}
if(!localStorage.getItem('pc_uid')) localStorage.setItem('pc_uid','U'+Math.random().toString(36).slice(2,10)); const UID=localStorage.getItem('pc_uid');
const K='pc_loans';
const nameEl=name, phoneEl=phone, amountEl=amount, purposeEl=purpose, monthsEl=months, rateEl=rate, collEl=collateral, emiBox=document.getElementById('emiBox');
nameEl.value=localStorage.getItem('pc_name')||''; phoneEl.value=localStorage.getItem('pc_phone')||'';
function getAll(){return JSON.parse(localStorage.getItem(K)||'[]');} function setAll(v){localStorage.setItem(K,JSON.stringify(v));}
function fmtMoney(x){return 'â‚¹'+Number(x).toLocaleString('en-IN');}
function emi(p, annualRate, m){const r=annualRate/12/100; if(!r) return p/m; return p*r*Math.pow(1+r,m)/(Math.pow(1+r,m)-1);}
calcBtn.onclick=()=>{const p=+amountEl.value||0, m=+monthsEl.value||0, r=+rateEl.value||12; if(!p||!m){alert('Enter amount & months');return;} const e=Math.round(emi(p,r,m)); emiBox.style.display='inline-block'; emiBox.textContent=`Est. EMI: ${fmtMoney(e)} @ ${r}%`;}
submitBtn.onclick=()=>{const name=(nameEl.value||'').trim(), phone=(phoneEl.value||'').trim(), amount=+amountEl.value||0, purpose=(purposeEl.value||'').trim(), months=+monthsEl.value||0, rate=+rateEl.value||0, collateral=(collEl.value||'').trim(); if(!name||!phone||!amount||!purpose||!months){alert('Fill all required');return;} localStorage.setItem('pc_name',name); localStorage.setItem('pc_phone',phone);
  const L=getAll(); L.push({id:'L'+Date.now().toString(36),uid:UID,name,phone,amount,purpose,months,rate:rate||null,collateral,status:'Pending',decision:null,ts:Date.now()}); setAll(L); render();};
function render(){const L=getAll(); const mine=L.filter(x=>x.uid===UID).sort((a,b)=>b.ts-a.ts); mineT.innerHTML=''; mineEmpty.style.display=mine.length?'none':'block';
  mine.forEach(x=>{const tr=document.createElement('tr'); const dec=x.decision?`â‚¹${x.decision.approvedAmount} / ${x.decision.months}m @ ${x.decision.rate}% (EMI â‚¹${x.decision.emi})`:'â€”';
    tr.innerHTML=`<td>${new Date(x.ts).toLocaleDateString('en-IN')}</td><td>${fmtMoney(x.amount)}</td><td>${x.months}m</td><td>${x.purpose}</td><td><span class="badge">${x.status}</span></td><td>${dec}</td>`; mineT.appendChild(tr);});
  allT.innerHTML=''; L.sort((a,b)=>b.ts-a.ts).forEach(x=>{const tr=document.createElement('tr'); tr.innerHTML=`<td>${new Date(x.ts).toLocaleDateString('en-IN')}</td><td>${x.name}</td><td>${x.phone}</td><td>${fmtMoney(x.amount)}</td><td>${x.months}m</td><td>${x.purpose}</td><td>${x.status}</td>`; allT.appendChild(tr);});
}
const mineT=document.getElementById('mine'), mineEmpty=document.getElementById('mineEmpty'), allT=document.getElementById('all'); render();
</script>
</body></html>
