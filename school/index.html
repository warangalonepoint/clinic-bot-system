<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School PWA</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* minimal banner style (kept here so it works even if CSS cache lags) */
    .banner-wrap{margin:12px 0 4px}
    .banner{
      width:100%; height:160px; object-fit:cover;
      border-radius:22px; display:block;
      box-shadow: var(--shadow);
      border:1px solid var(--ring);
    }
  </style>
</head>
<body class="dark">
  <div class="wrapper">
    <!-- Hero / Banner -->
    <section class="accent-indigo">
      <div class="glass header">
        <div class="banner-wrap">
          <!-- Try assets/banner.png first, then fall back to /school/assets/banner.png -->
          <img class="banner"
               src="assets/banner.png"
               onerror="this.onerror=null; this.src='assets/school_banner.png';" 
               alt="School banner" />
        </div>

        <div class="row" style="align-items:center; justify-content:space-between">
          <div class="h1">School Demo</div>
          <button class="btn" onclick="toggleTheme()">Theme</button>
        </div>

        <div class="row mt-12">
          <a class="btn tab-btn btn-indigo" href="parents.html">Parents</a>
          <a class="btn tab-btn btn-indigo" href="teacher.html">Teacher</a>
          <a class="btn tab-btn btn-teal"   href="coordinator.html">Coordinator</a>
          <a class="btn tab-btn btn-rose"   href="admin.html">Admin</a>
        </div>
        <div class="text-dim mt-8">Neon • Dark/Light</div>
      </div>
    </section>

    <!-- PIN -->
    <section class="accent-teal">
      <div class="glass mt-16">
        <div class="h1">Enter PIN</div>
        <p class="text-dim">You’ll be routed to your role automatically.</p>

        <form id="pin-form" class="grid mt-12" onsubmit="return false;">
          <input id="pin-input" class="input" inputmode="numeric" pattern="[0-9]*" maxlength="8"
                 placeholder="4–8 digit PIN" autocomplete="one-time-code" />
          <div class="row">
            <button id="pin-go" class="btn btn-teal">Continue</button>
          </div>
          <div id="pin-msg" class="text-dim"></div>
        </form>
      </div>
    </section>
  </div>

  <!-- Shared UI (tabs/theme) -->
  <script type="module" src="ui.js"></script>

  <!-- PIN Router (self-contained) -->
  <script>
  (function(){
    // Inline fallback (works even if pins.json missing)
    let pinMap = {
      "1111":"parents",
      "2222":"teacher",
      "3333":"coordinator",
      "4444":"admin"
    };

    // Try to load pins.json from the same folder (/school/)
    fetch('pins.json', {cache:'no-store'})
      .then(r => r.ok ? r.json() : null)
      .then(json => { if(json && typeof json === 'object') pinMap = json; })
      .catch(()=>{ /* ignore; fallback is already set */ });

    const form = document.getElementById('pin-form');
    const input = document.getElementById('pin-input');
    const go = document.getElementById('pin-go');
    const msg = document.getElementById('pin-msg');

    function route(){
      const pin = (input.value || '').trim();
      if(!pin){ msg.textContent='Enter a PIN.'; return; }
      const role = pinMap[pin];
      if(!role){
        msg.textContent = 'Unknown PIN. Please try again.';
        return;
      }
      // Persist theme preference across pages
      const theme = localStorage.getItem('theme') || 'dark';
      const url = role.toLowerCase() + '.html';
      // add cache-buster to avoid stale HTML on GH Pages
      const q = (url.includes('?')?'&':'?') + 't=' + Date.now() + '&theme=' + theme;
      location.href = url + q;
    }

    go.addEventListener('click', route);
    form.addEventListener('submit', route);
  })();
  </script>
</body>
</html>
