<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Your Appointment</title>
  <link rel="stylesheet" href="./assets/styles.css">
</head>
<body>
  <header>
    <div class="header-logo">
      <img src="./logo.png" alt="Clinic Logo">
      <h1>Onestop AI Clinic Demo</h1>
    </div>
  </header>

  <section class="hero-banner">
    <img src="./clinic-hero-banner.png" alt="Doctor Illustration">
  </section>

  <section class="booking-form">
    <h2>Book Your Appointment</h2>
    <form id="bookingForm">
      <select id="dateDropdown" required>
        <option value="">Select Date</option>
      </select>
      <select id="timeDropdown" required>
        <option value="">Select Time Slot</option>
      </select>
      <input type="text" id="patientName" placeholder="Patient Name" required>
      <input type="text" id="visitReason" placeholder="Reason for Visit" required>
      <button type="submit">Book on WhatsApp</button>
    </form>
  </section>

  <footer>
    <p>Powered by Onestop AI</p>
  </footer>

  <script>
    let slotsData = [];

    // Fetch Slots CSV
    fetch('./slots.csv')
      .then(response => response.text())
      .then(data => {
        const lines = data.trim().split('\n').slice(1); // skip header
        slotsData = lines.map(line => {
          const [date, time, status] = line.split(',');
          return { date: date.trim(), time: time.trim(), status: status.trim() };
        });

        // Populate Date Dropdown
        const uniqueDates = [...new Set(slotsData.map(slot => slot.date))];
        const dateDropdown = document.getElementById('dateDropdown');
        uniqueDates.forEach(date => {
          const option = document.createElement('option');
          option.value = date;
          option.textContent = date;
          dateDropdown.appendChild(option);
        });
      });

    // Populate Time Slots based on selected Date
    document.getElementById('dateDropdown').addEventListener('change', function() {
      const selectedDate = this.value;
      const timeDropdown = document.getElementById('timeDropdown');
      timeDropdown.innerHTML = '<option value="">Select Time Slot</option>';

      slotsData
        .filter(slot => slot.date === selectedDate && slot.status === 'Available')
        .forEach(slot => {
          const option = document.createElement('option');
          option.value = slot.time;
          option.textContent = slot.time;
          timeDropdown.appendChild(option);
        });
    });

    // Booking Form Submission
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const date = document.getElementById('dateDropdown').value;
      const time = document.getElementById('timeDropdown').value;
      const patientName = document.getElementById('patientName').value.trim();
      const reason = document.getElementById('visitReason').value.trim();

      if (!date || !time || !patientName || !reason) {
        alert('Please fill all fields.');
        return;
      }

      const whatsappMessage = `Booking Request:%0AName: ${patientName}%0AReason: ${reason}%0ADate: ${date}%0ATime: ${time}`;
      window.location.href = `https://wa.me/919876543210?text=${whatsappMessage}`;
    });
  </script>
</body>
</html>
