<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Booking Logs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    button, select {
      margin: 0 5px;
      padding: 5px 10px;
    }
    .log-entry {
      background: #fff;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .log-entry strong {
      display: inline-block;
      width: 100px;
    }
  </style>
</head>
<body>
  <h1>Booking Logs</h1>
  <div class="controls">
    <button onclick="filterByDate('today')">Today</button>
    <button onclick="filterByDate('yesterday')">Yesterday</button>
    <select id="clinicSelect" onchange="loadLogs()"></select>
  </div>
  <div id="logContainer">Loading...</div>

  <script>
    const logContainer = document.getElementById('logContainer');
    const clinicSelect = document.getElementById('clinicSelect');

    const today = new Date().toISOString().split('T')[0];
    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

    let logsData = [];
    let currentFilterDate = null;

    async function loadLogs() {
      const clinic = clinicSelect.value || "clinic";
      const csvUrl = `./${clinic}-logs.csv`;
      try {
        const res = await fetch(csvUrl);
        const text = await res.text();
        const rows = text.trim().split('\n').slice(1); // Skip header
        logsData = rows.map(row => {
          const [Time, Reason, Name, Contact, Date, Token] = row.split(',');
          return { Time, Reason, Name, Contact, Date, Token };
        });
        renderLogs();
      } catch (err) {
        logContainer.innerHTML = "Failed to load logs.";
      }
    }

    function renderLogs() {
      logContainer.innerHTML = '';
      let filteredLogs = logsData;

      if (currentFilterDate) {
        filteredLogs = logsData.filter(log => log.Date === currentFilterDate);
      }

      if (filteredLogs.length === 0) {
        logContainer.innerHTML = "<p>No bookings found.</p>";
        return;
      }

      filteredLogs.forEach(log => {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `
          <p><strong>Name:</strong> ${log.Name}</p>
          <p><strong>Reason:</strong> ${log.Reason}</p>
          <p><strong>Date:</strong> ${log.Date}</p>
          <p><strong>Time:</strong> ${log.Time}</p>
          <p><strong>Contact:</strong> <a href="tel:${log.Contact}">${log.Contact}</a></p>
          <p><strong>Token No:</strong> ${log.Token}</p>
        `;
        logContainer.appendChild(entry);
      });
    }

    function filterByDate(filter) {
      currentFilterDate = filter === 'today' ? today : filter === 'yesterday' ? yesterday : null;
      renderLogs();
    }

    function populateClinics() {
      const clinics = ["clinic"]; // Add more clinic CSV names if needed
      clinics.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name.charAt(0).toUpperCase() + name.slice(1);
        clinicSelect.appendChild(opt);
      });
      loadLogs();
    }

    populateClinics();
  </script>
</body>
</html>
