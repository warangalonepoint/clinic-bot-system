<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School PWA</title>

  <!-- Apply theme before paint -->
  <script>
    (function () {
      var t = localStorage.getItem('theme') || 'dark';
      document.documentElement.classList.add(t);
      document.addEventListener('DOMContentLoaded', function () {
        document.body.classList.add(t);
      });
    })();
  </script>

  <!-- Force-fresh CSS (cache buster) -->
  <link rel="preload" href="styles.css?v=2025-08-15-2" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="styles.css?v=2025-08-15-2"></noscript>

  <!-- tiny fallback so banner still looks ok if CSS fails -->
  <style>
    .banner-wrap{margin:16px 0 6px}
    .banner{width:100%;height:160px;object-fit:cover;border-radius:22px;display:block}
  </style>
</head>
<body>
  <div class="wrapper">

    <!-- HERO -->
    <section class="accent-indigo">
      <div class="glass header">
        <div class="banner-wrap">
          <img class="banner" src="assets/banner.png"
               onerror="this.onerror=null;this.src='assets/school_banner.png';"
               alt="School banner">
        </div>

        <div class="row between center">
          <div>
            <div class="h1">School PWA</div>
            <div class="text-dim">Neon Glass · Dark/Light</div>
          </div>
          <button class="btn" id="themeBtn" title="Toggle theme">Theme</button>
        </div>

        <div class="grid mt-16" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;">
          <a class="chip chip-indigo" href="parents.html">Parents</a>
          <a class="chip chip-blue"   href="teacher.html">Teacher</a>
          <a class="chip chip-teal"   href="coordinator.html">Coordinator</a>
          <a class="chip chip-pink"   href="admin.html">Admin</a>
        </div>
      </div>
    </section>

    <!-- PIN ROUTER -->
    <section class="accent-teal">
      <div class="glass mt-16">
        <div class="h1">Enter PIN</div>
        <p class="text-dim">You’ll be routed to your role automatically.</p>

        <form id="pin-form" class="grid mt-12" onsubmit="return false;">
          <input id="pin-input" class="input" inputmode="numeric" pattern="[0-9]*" maxlength="8"
                 placeholder="4–8 digit PIN" autocomplete="one-time-code" />
          <div class="row">
            <button id="pin-go" class="btn btn-teal">Continue</button>
          </div>
          <div id="pin-msg" class="text-dim mt-8"></div>
        </form>
      </div>
    </section>
  </div>

  <!-- Core helper (tabs/theme). Works even if ui.js is cached -->
  <script>
    function toggleTheme(){
      var cur = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      var next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.classList.remove(cur);
      document.body.classList.remove(cur);
      document.documentElement.classList.add(next);
      document.body.classList.add(next);
      localStorage.setItem('theme', next);
    }
    document.getElementById('themeBtn').addEventListener('click', toggleTheme);
  </script>

  <!-- PIN Router -->
  <script>
  (function(){
    let pinMap = { "1111":"parents","2222":"teacher","3333":"coordinator","4444":"admin" };
    fetch('pins.json', {cache:'no-store'})
      .then(r => r.ok ? r.json() : null)
      .then(j => { if(j && typeof j==='object') pinMap = j; })
      .catch(()=>{});

    const form = document.getElementById('pin-form');
    const input= document.getElementById('pin-input');
    const go   = document.getElementById('pin-go');
    const msg  = document.getElementById('pin-msg');

    function route(){
      const pin = (input.value||'').trim();
      if(!pin){ msg.textContent='Enter a PIN.'; return; }
      const role = pinMap[pin];
      if(!role){ msg.textContent='Unknown PIN. Please try again.'; return; }
      const theme = localStorage.getItem('theme') || 'dark';
      const url   = role.toLowerCase() + '.html';
      location.href = url + (url.includes('?')?'&':'?') + 't=' + Date.now() + '&theme=' + theme;
    }
    go.addEventListener('click', route);
    form.addEventListener('submit', route);
  })();
  </script>

  <!-- Optional shared JS (still add cache buster) -->
  <script type="module" src="ui.js?v=2025-08-15-2"></script>
</body>
</html>
