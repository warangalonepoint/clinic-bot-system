<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Coordinator Panel</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0a0a14"/>

  <link rel="stylesheet" href="./styles.css?v=glass-1.0"/>

  <style>
    .wrap { max-width: 880px; margin: 18px auto; padding: 0 14px; }
    .banner img { width: 100%; border-radius: 18px; }
    h2 { margin: 16px 0 10px; }
    table { width:100%; border-collapse: collapse; margin-top:12px; font-size:.9rem }
    th,td { border-bottom:1px solid rgba(255,255,255,0.08); padding:8px 6px; text-align:left }
    th { opacity:.8 }
  </style>
</head>
<body>
  <main class="wrap">
    <!-- Banner -->
    <section class="banner card">
      <img src="./assets/banner.png" alt="School banner"/>
      <div class="title-overlay">
        <div class="title">Coordinator Panel</div>
        <div class="subtitle">Manage class timetable & meta</div>
      </div>
      <button id="logoutBtn" class="btn btn-danger small" style="position:absolute;top:14px;right:14px;">Logout</button>
    </section>

    <!-- Class Setup -->
    <section class="card" style="padding:20px;">
      <h2>Class Setup</h2>
      <p>Choose class/section & meta for actions below</p>

      <label class="label">Class</label>
      <input id="class" class="input" placeholder="e.g., 5"/>

      <label class="label">Section</label>
      <input id="section" class="input" placeholder="e.g., A"/>

      <label class="label">Day</label>
      <select id="day" class="input">
        <option>Mon</option><option>Tue</option><option>Wed</option>
        <option>Thu</option><option>Fri</option><option>Sat</option>
      </select>

      <label class="label">Period #</label>
      <input id="period" class="input" placeholder="1â€“12"/>

      <label class="label">Subject</label>
      <input id="subject" class="input" placeholder="e.g., Maths"/>

      <button id="saveMeta" class="btn btn-primary" style="margin-top:12px;">Save Meta</button>
    </section>

    <!-- Timetable Editor -->
    <section class="card" style="padding:20px;">
      <h2>Timetable</h2>
      <p>Add/replace period entries for the selected class</p>

      <label class="label">Teacher Name</label>
      <input id="teacher" class="input" placeholder="e.g., Ms. Priya"/>

      <label class="label">Room (optional)</label>
      <input id="room" class="input" placeholder="Room #"/>

      <button id="addUpdate" class="btn btn-success" style="margin-top:12px;">Add / Update</button>

      <table id="timetableTable">
        <thead>
          <tr>
            <th>#</th><th>Day</th><th>Period</th><th>Subject</th>
            <th>Teacher</th><th>Room</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="exportCsv" class="btn btn-secondary">Export CSV</button>
        <button id="clear" class="btn btn-danger">Clear Class Timetable</button>
      </div>
    </section>
  </main>

  <script>
    // Redirect if not logged in
    (()=>{
      const r=sessionStorage.getItem('sch_role');
      if(r!=='coordinator'){ location.replace('./index.html'); }
    })();

    document.getElementById('logoutBtn').onclick=()=>{
      sessionStorage.clear();
      location.replace('./index.html');
    };

    const tableBody=document.querySelector('#timetableTable tbody');
    let entries=[];

    function render(){
      tableBody.innerHTML='';
      entries.forEach((row,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${i+1}</td>
          <td>${row.day}</td><td>${row.period}</td><td>${row.subject}</td>
          <td>${row.teacher}</td><td>${row.room||''}</td>
          <td><button data-i="${i}" class="btn btn-danger small">Del</button></td>`;
        tableBody.appendChild(tr);
      });
    }

    document.getElementById('addUpdate').onclick=()=>{
      const cls=document.getElementById('class').value.trim();
      const sec=document.getElementById('section').value.trim();
      const day=document.getElementById('day').value;
      const per=document.getElementById('period').value.trim();
      const sub=document.getElementById('subject').value.trim();
      const teacher=document.getElementById('teacher').value.trim();
      const room=document.getElementById('room').value.trim();
      if(!cls||!sec||!per||!sub||!teacher) return alert('Fill all required');
      entries.push({cls,sec,day,period:per,subject:sub,teacher,room});
      render();
    };

    tableBody.addEventListener('click',(e)=>{
      if(e.target.dataset.i){
        entries.splice(e.target.dataset.i,1);
        render();
      }
    });

    document.getElementById('exportCsv').onclick=()=>{
      let csv="Day,Period,Subject,Teacher,Room\n";
      entries.forEach(r=>{ csv+=`${r.day},${r.period},${r.subject},${r.teacher},${r.room||''}\n`;});
      const blob=new Blob([csv],{type:'text/csv'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='timetable.csv';
      a.click();
    };

    document.getElementById('clear').onclick=()=>{
      if(confirm('Clear all entries?')){ entries=[];render(); }
    };
  </script>
</body>
</html>
