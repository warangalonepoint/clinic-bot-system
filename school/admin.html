<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Admin · School Demo</title>
  <link rel="stylesheet" href="styles.css">
<script type="module" src="ui.js"></script>
</head>
<body class="dark">
  <div class="wrapper">
    <section class="accent-rose">
      <div class="glass header">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div class="h1">Admin</div>
          <div class="row">
            <a class="btn" href="index.html">PIN</a>
            <button class="btn btn-gradient" onclick="toggleTheme()">Theme</button>
          </div>
        </div>
        <div class="text-dim">Scope, broadcast, leaves, data, backup</div>
      </div>
    </section>

    <div class="tabs mt-16">
      <div class="tab-list">
        <button class="tab-btn" data-tab="a-scope" aria-selected="true">Scope</button>
        <button class="tab-btn" data-tab="a-bcast">Broadcast</button>
        <button class="tab-btn" data-tab="a-leaves">Leaves</button>
        <button class="tab-btn" data-tab="a-data">Data</button>
        <button class="tab-btn" data-tab="a-backup">Backup</button>
      </div>
    </div>

    <div class="tab-panels">
      <!-- Scope -->
      <div class="tab-panel active" id="a-scope">
        <section class="accent-violet">
          <div class="glass">
            <div class="h2">Class Scope</div>
            <div class="grid cols-2">
              <input id="as-class" class="input" placeholder="Class eg, 5">
              <input id="as-sec" class="input" placeholder="Section eg, A">
            </div>
            <div class="mt-12"><button class="btn btn-indigo" id="asSave">Save</button></div>
          </div>
        </section>
      </div>

      <!-- Broadcast -->
      <div class="tab-panel" id="a-bcast">
        <section class="accent-teal">
          <div class="glass">
            <div class="h2">Broadcast to Parents</div>
            <textarea id="abText" class="input" placeholder="Message…"></textarea>
            <div class="mt-12"><button class="btn btn-teal" id="abSend">Send</button></div>
            <div id="abList" class="mt-12"></div>
          </div>
        </section>
      </div>

      <!-- Leaves -->
      <div class="tab-panel" id="a-leaves">
        <section class="accent-indigo">
          <div class="glass">
            <div class="h2">Leave Requests</div>
            <div id="alList" class="mt-12"></div>
          </div>
        </section>
      </div>

      <!-- Data -->
      <div class="tab-panel" id="a-data">
        <section class="accent-rose">
          <div class="glass">
            <div class="h2">Data</div>
            <div class="text-dim">This demo shows local data only.</div>
            <div class="grid cols-3 mt-12">
              <button class="btn">Students.csv</button>
              <button class="btn">Teachers.csv</button>
              <button class="btn">Timetable.csv</button>
            </div>
          </div>
        </section>
      </div>

      <!-- Backup -->
      <div class="tab-panel" id="a-backup">
        <section class="accent-rose">
          <div class="glass">
            <div class="h2">Quick Backup / Restore</div>
            <div class="row mt-12">
              <button class="btn btn-rose" id="bk">Backup</button>
              <button class="btn btn-rose" id="rs">Restore</button>
            </div>
            <input id="bkFile" class="input mt-12" type="file" accept="application/json">
          </div>
        </section>
      </div>
    </div>
  </div>

  <script type="module" src="ui.js"></script>
  <script>
  const db = {
    get(k,def){ try{ return JSON.parse(localStorage.getItem(k)) ?? def; }catch{ return def; } },
    set(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
  };

  // Scope
  const scopeKey='adminScope';
  document.getElementById('asSave').onclick=()=>{
    db.set(scopeKey,{cls:gid('as-class').value.trim(),sec:gid('as-sec').value.trim()});
    alert('Saved.');
  };

  // Broadcast
  function renderB(){
    const arr=db.get('broadcasts',[]);
    gid('abList').innerHTML=arr.map(b=>`<div class="glass"><span class="text-dim">${new Date(b.time).toLocaleString()}</span><div class="mt-8">${b.text}</div></div>`).join('') || '<div class="text-dim">No broadcasts.</div>';
  }
  gid('abSend').onclick=()=>{
    const txt=(gid('abText').value||'').trim(); if(!txt) return;
    const arr=db.get('broadcasts',[]); arr.unshift({time:Date.now(), text:txt}); db.set('broadcasts',arr);
    gid('abText').value=''; renderB();
  };

  // Leaves (approve/deny demo)
  function renderLeaves(){
    const arr=db.get('leaves',[]);
    gid('alList').innerHTML = arr.map((l,i)=>`
      <div class="glass">
        <div><b>${l.date}</b> · ${l.days} day(s) — <span class="text-dim">${l.reason}</span></div>
        <div class="row mt-12">
          <button class="btn btn-teal" onclick="setLs(${i},'Approved')">Approve</button>
          <button class="btn btn-rose" onclick="setLs(${i},'Denied')">Deny</button>
        </div>
      </div>`).join('') || '<div class="text-dim">No pending requests.</div>';
  }
  window.setLs=(i,status)=>{
    const arr=db.get('leaves',[]);
    if(arr[i]){ arr[i].status=status; db.set('leaves',arr); renderLeaves(); }
  };

  // Backup/Restore
  gid('bk').onclick=()=>{
    const all={localStorage:{...localStorage}};
    const blob=new Blob([JSON.stringify(all,null,2)],{type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='school-backup.json'; a.click();
  };
  gid('rs').onclick=()=> gid('bkFile').click();
  gid('bkFile').addEventListener('change', async (e)=>{
    const f=e.target.files?.[0]; if(!f) return;
    const j=JSON.parse(await f.text());
    if(j.localStorage){ Object.entries(j.localStorage).forEach(([k,v])=>localStorage.setItem(k,v)); alert('Restored.'); renderB(); renderLeaves(); }
  });

  function gid(id){ return document.getElementById(id); }
  renderB(); renderLeaves();
  </script>
</body>
</html>
