<!-- logs.html v47 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clinic Booking Logs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      padding: 20px;
    }
    h2 {
      color: #4caf50;
      text-align: center;
    }
    #logsTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    #logsTable th, #logsTable td {
      border: 1px solid #444;
      padding: 8px;
      text-align: center;
    }
    #logsTable th {
      background: #222;
      color: #0f0;
    }
    input, select, button {
      padding: 6px;
      margin: 4px;
    }
    .top-bar {
      text-align: center;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<h2>ðŸ“‹ Booking Logs</h2>
<div class="top-bar">
  <button onclick="filterDate('today')">Today</button>
  <button onclick="filterDate('yesterday')">Yesterday</button>
  <input type="date" id="startDate"> to 
  <input type="date" id="endDate">
  <button onclick="filterDate('custom')">Apply</button>
</div>

<table id="logsTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>Name</th>
      <th>Reason</th>
      <th>Contact</th>
      <th>Token</th>
      <th>Reminder</th>
    </tr>
  </thead>
  <tbody id="logsBody"></tbody>
</table>

<script>
let logData = [];
let clinic = '';

function getPIN() {
  const url = new URL(window.location.href);
  return url.searchParams.get("pin") || '';
}

function loadPlansJson(pin) {
  fetch('plans.json')
    .then(res => res.json())
    .then(plans => {
      const plan = plans.find(p => p.pin === pin);
      if (!plan) {
        alert("Invalid PIN");
        return;
      }
      clinic = plan.clinic;
      loadLogs(clinic);
    })
    .catch(() => alert("Error loading plans.json"));
}

function loadLogs(clinic) {
  fetch(`${clinic}-logs.csv`)
    .then(res => res.text())
    .then(csv => {
      const rows = csv.trim().split('\n').slice(1);
      logData = rows.map(r => {
        const [Date, Time, Name, Reason, Contact, Token, Reminder] = r.split(',');
        return { Date, Time, Name, Reason, Contact, Token, Reminder };
      });
      renderTable(logData);
    })
    .catch(() => alert("Error loading logs"));
}

function renderTable(data) {
  const tbody = document.getElementById('logsBody');
  tbody.innerHTML = '';
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row.Date}</td>
      <td>${row.Time}</td>
      <td>${row.Name}</td>
      <td>${row.Reason}</td>
      <td><a href="tel:${row.Contact}" style="color:#0cf;">${row.Contact}</a></td>
      <td>${row.Token}</td>
      <td>${row.Reminder || ''}</td>
    `;
    tbody.appendChild(tr);
  });
}

function filterDate(type) {
  let filtered = [];
  if (type === 'today' || type === 'yesterday') {
    const today = new Date();
    if (type === 'yesterday') today.setDate(today.getDate() - 1);
    const dateStr = today.toISOString().split('T')[0];
    filtered = logData.filter(e => e.Date === dateStr);
  } else {
    const sd = document.getElementById('startDate').value;
    const ed = document.getElementById('endDate').value;
    filtered = logData.filter(e => e.Date >= sd && e.Date <= ed);
  }
  renderTable(filtered);
}

const pin = getPIN();
if (!pin) {
  alert("PIN missing from URL");
} else {
  loadPlansJson(pin);
}
</script>

</body>
</html>});
</script>

</body>
</html>
