<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WhatsApp Booking - Onestop C-Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    #slotSection, #bookingForm { max-width: 500px; margin: auto; }
    #bookingForm input, #bookingForm select, #bookingForm button {
      width: 100%; padding: 10px; margin: 10px 0; font-size: 1rem;
    }
  </style>
</head>
<body>
  <img src="./assets/banner.png" alt="Banner" style="width:100%;max-height:150px;object-fit:cover" />
  <h2 style="text-align:center;margin-top:10px;">Onestop C-Demo</h2>
  <h3 style="text-align:center;color:gray;">Book via WhatsApp</h3>

  <div id="bookingForm">
    <input type="text" id="name" placeholder="Your Name" required />
    <input type="tel" id="contact" placeholder="Contact Number" required />
    <input type="text" id="reason" placeholder="Reason for Visit" required />

    <select id="dateSelect"><option>Select Date</option></select>
    <select id="timeSelect"><option>Select Slot</option></select>

    <button onclick="sendBooking()">Book on WhatsApp</button>
  </div>

  <footer><p>Powered by Onestop AI</p></footer>

  <script>
    const airtableAPI = 'https://api.airtable.com/v0/app1T8WiRqZIR4xY/AvailableSlots?api_key=YOUR_API_KEY';
    let slotsData = [];

    fetch(airtableAPI)
      .then(res => res.json())
      .then(data => {
        slotsData = data.records;
        const dates = [...new Set(slotsData.map(rec => rec.fields.Date))];
        const dateDropdown = document.getElementById('dateSelect');
        dates.forEach(d => {
          const opt = document.createElement('option');
          opt.value = d; opt.textContent = d;
          dateDropdown.appendChild(opt);
        });
      });

    document.getElementById('dateSelect').addEventListener('change', function() {
      const selectedDate = this.value;
      const timeSelect = document.getElementById('timeSelect');
      timeSelect.innerHTML = '<option>Select Slot</option>';
      const slots = slotsData.filter(rec => rec.fields.Date === selectedDate && rec.fields.Status !== 'Booked');
      slots.forEach(slot => {
        const opt = document.createElement('option');
        opt.value = slot.fields['Time Slot'];
        opt.textContent = slot.fields['Time Slot'];
        timeSelect.appendChild(opt);
      });
    });

    function sendBooking() {
      const name = document.getElementById('name').value.trim();
      const contact = document.getElementById('contact').value.trim();
      const reason = document.getElementById('reason').value.trim();
      const date = document.getElementById('dateSelect').value;
      const slot = document.getElementById('timeSelect').value;

      if (!name || !contact || !reason || date === "Select Date" || slot === "Select Slot") {
        alert("Please fill in all details.");
        return;
      }

      const msg = `Booking Request:%0AName: ${name}%0AContact: ${contact}%0AReason: ${reason}%0ADate: ${date}%0ATime: ${slot}`;
      window.location.href = `https://wa.me/919390664577?text=${msg}`;
    }
  </script>
</body>
</html>
