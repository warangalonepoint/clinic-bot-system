<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clinic Appointment Booking | Slot Selection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        input, select, button { display: block; width: 100%; padding: 12px; margin-top: 15px; border-radius: 10px; font-size: 16px; }
        button { background: black; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Clinic Appointment Booking (Slot Selection)</h2>

    <input type="text" id="patientName" placeholder="Patient Name">

    <select id="bookingDate">
        <option>Select Date</option>
        <option>2025-08-06</option>
        <option>2025-08-07</option>
        <option>2025-08-08</option>
    </select>

    <select id="slotTime">
        <option>Select Time Slot</option>
        <option>10:00 AM</option>
        <option>10:30 AM</option>
        <option>11:00 AM</option>
        <option>11:30 AM</option>
        <option>12:00 PM</option>
    </select>

    <input type="text" id="reason" placeholder="Reason for Visit">

    <button onclick="submitBooking()">Book Appointment</button>
    <div id="status" style="margin-top: 20px; color: green;"></div>

    <script>
        const API_KEY = 'patLNwoJQKE3Tjb8J.c2a0db129111c610fae64a2c01e0a626f37bdb5992232ea6ebc644fa9073dfb3';
        const BASE_ID = 'appgIT8WiqnZlR44Y';
        const TABLE_NAME = 'BookingsLogs';

        function submitBooking() {
            const patientName = document.getElementById('patientName').value.trim();
            const bookingDate = document.getElementById('bookingDate').value;
            const slotTime = document.getElementById('slotTime').value;
            const reason = document.getElementById('reason').value.trim();

            if(patientName === "" || bookingDate === "Select Date" || slotTime === "Select Time Slot" || reason === "") {
                alert("Please fill all fields correctly.");
                return;
            }

            const data = {
                records: [
                    {
                        fields: {
                            "Timestamp": new Date().toLocaleString(),
                            "Patient Name": patientName,
                            "Slot Time": bookingDate + " " + slotTime,
                            "Reason": reason
                        }
                    }
                ]
            };

            fetch(`https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                document.getElementById('status').innerText = "Booking Logged Successfully! Redirecting to WhatsApp...";
                
                const clinicName = "Onestop Clinic";
                const whatsappNumber = "919390664577";

                const message = `Hello, this is ${patientName}. My appointment has been booked for ${bookingDate} at ${slotTime} with ${clinicName}.`;

                const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
                window.location.href = whatsappURL;

                document.getElementById('patientName').value = "";
                document.getElementById('bookingDate').selectedIndex = 0;
                document.getElementById('slotTime').selectedIndex = 0;
                document.getElementById('reason').value = "";
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Failed to log booking.");
            });
        }
    </script>

</body>
</html>
