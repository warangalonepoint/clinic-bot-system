<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Teacher</title>
<link rel="stylesheet" href="styles.css"/>
<style>
  .note{padding:10px;margin:10px 0;border:1px solid #2a344a;border-radius:10px;background:#101623;color:#cbd5e1}
</style>
</head>
<body class="dark">
<div class="wrapper">

  <section class="accent-teal">
    <div class="glass header">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>
          <div class="eyebrow"></div>
          <div class="h1">Teacher</div>
        </div>
        <div class="buttons">
          <button class="btn" onclick="toggleTheme()">Theme</button>
          <a class="btn" href="./logout.html">Logout</a>
        </div>
      </div>

      <div class="tab-row" id="tabs">
        <button class="chip chip-indigo" data-tab="setup">Class Setup</button>
        <button class="chip chip-blue"   data-tab="diary">Class Diary</button>
        <button class="chip chip-teal"   data-tab="homework">Homework</button>
        <button class="chip chip-amber"  data-tab="attendance">Attendance</button>
        <button class="chip chip-fuchsia"data-tab="leaves">Leaves</button>
        <button class="chip chip-violet" data-tab="requests">Requests</button>
        <button class="chip chip-cyan"   data-tab="marks">Marks</button>
      </div>
    </div>
  </section>

  <!-- Panels -->
  <section id="panel-setup" class="glass inner panel">
    <div class="h1">My Class</div>
    <form class="form-grid mt-12" data-queue="t-setup">
      <input class="input full" placeholder="Class e.g., 5"   name="class"/>
      <input class="input full" placeholder="Section e.g., A" name="section"/>
      <input class="input full" placeholder="Your Name"       name="teacher"/>
      <input class="input full" placeholder="Subject e.g., Maths" name="subject"/>
      <button class="btn btn-indigo">Save</button>
    </form>
  </section>

  <section id="panel-diary" class="glass inner panel" hidden>
    <div class="h1">Post to Class Diary</div>
    <form id="diaryForm" class="form-grid mt-12">
      <input class="input full" name="class" placeholder="Class (e.g., 5-A)" required/>
      <select class="input full" name="subject" required>
        <option>Maths</option><option>Science</option><option>English</option>
      </select>
      <textarea class="input full" name="notes" placeholder="What was taught / notes..." required></textarea>
      <input class="input" type="date" name="date"/>
      <button class="btn btn-blue" type="submit">Post</button>
    </form>
    <div id="diaryStatus" class="note" hidden></div>
  </section>

  <section id="panel-homework" class="glass inner panel" hidden>
    <div class="h1">Give Homework</div>
    <form class="form-grid mt-12" data-queue="t-homework">
      <select class="input full" name="subject">
        <option>Maths</option><option>Science</option><option>English</option>
      </select>
      <input class="input" name="due" type="date"/>
      <textarea class="input full" name="task" placeholder="Exercise / description…"></textarea>
      <button class="btn btn-teal">Assign</button>
    </form>
  </section>

  <section id="panel-attendance" class="glass inner panel" hidden>
    <div class="h1">Mark Attendance</div>
    <form class="form-grid mt-12" data-queue="t-attendance">
      <input class="input" type="date" name="date"/>
      <select class="input" name="status">
        <option>Present</option><option>Absent</option><option>Late</option>
      </select>
      <input class="input full" name="student" placeholder="Roll / Name"/>
      <button class="btn btn-amber">Save</button>
    </form>
  </section>

  <section id="panel-leaves" class="glass inner panel" hidden>
    <div class="h1">Leave Approvals</div>
    <div class="list mt-12">
      <div class="item"><span>R-21 — Fever (1 day)</span><button class="btn btn-teal">Approve</button></div>
    </div>
  </section>

  <section id="panel-requests" class="glass inner panel" hidden>
    <div class="h1">Parent Requests</div>
    <div class="list mt-12"><div class="item"><span>No requests</span></div></div>
  </section>

  <section id="panel-marks" class="glass inner panel" hidden>
    <div class="h1">Enter Marks</div>
    <form class="form-grid mt-12" data-queue="t-marks">
      <input class="input" placeholder="Exam e.g., Unit Test 1" name="exam"/>
      <input class="input" placeholder="Roll No" name="roll"/>
      <input class="input" placeholder="Marks / 100" name="marks" inputmode="numeric"/>
      <button class="btn btn-cyan">Save</button>
    </form>
  </section>

</div>
<div class="toast" aria-live="polite"></div>

<!-- Tabs + form binding -->
<script type="module">
  import {initTabs, bindQueueForms} from './ui.js';
  initTabs(document); bindQueueForms(document);
</script>

<!-- Supabase hook for Class Diary -->
<script type="module">
  import { requireLogin } from "./js/supabase.js";
  import { addDiary } from "./js/diary.js";

  // Force login
  await requireLogin();

  const form = document.querySelector("#diaryForm");
  const status = document.querySelector("#diaryStatus");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    const ok = await addDiary({
      klass: fd.get("class"),
      subject: fd.get("subject"),
      note: fd.get("notes"),
      date: fd.get("date") || new Date().toISOString().slice(0,10)
    });
    if (ok) {
      status.hidden = false;
      status.textContent = "✅ Note posted to diary.";
      form.reset();
    } else {
      status.hidden = false;
      status.textContent = "❌ Failed to post. Check role or network.";
    }
  });
</script>
<script type="module" src="ui.js"></script>
</body>
</html>
